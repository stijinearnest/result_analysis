{% if already_exists %}
<p>Marks for this semester already exist. You cannot add again.</p>
<a href="{% url 'teacher_dashboard' %}">Back to Dashboard</a>
{% else %}
<form id="marksForm">
    <table border="1" cellpadding="8">
        <tr>
            <th>Subject Code</th>
            <th>Subject Name</th>
            <th>Marks Obtained</th>
            <th>Max Marks</th>
        </tr>
        {% for subject in subjects %}
        <tr>
            <td>{{ subject.code }}</td>
            <td>{{ subject.name }}</td>
            <td>
                <input type="number" name="marks_{{ subject.id }}" min="0" max="40" step="0.5" required>
            </td>
            <td>
                <input type="number" name="max_{{ subject.id }}" min="1" value="40" required>
            </td>
        </tr>
        {% endfor %}
    </table>
    <input type="hidden" name="student_id" value="{{ student.id }}">
    <input type="hidden" name="semester" value="{{ semester }}">
    <button type="submit">Save Marks</button>
</form>

<script>
document.getElementById('marksForm').addEventListener('submit', function(e){
    e.preventDefault();
    const formData = new FormData(this);

    fetch("", {
        method: "POST",
        headers: {
            "X-Requested-With": "XMLHttpRequest"
        },
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        alert(data.message || "Done!");
        if(data.success) location.reload();
    })
    .catch(err => console.log(err));
});
</script>
{% endif %}
