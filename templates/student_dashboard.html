{% extends "base.html" %}
{% load static %}
{% block content %}

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- External CSS -->
<link rel="stylesheet" href="{% static 'css/student_dashboard.css' %}">

<div class="dash-wrap">
  <div class="grid">
    <!-- LEFT COLUMN -->
    <div class="left-col">
      <!-- Student card -->
      <section class="card student-card">
        <div class="student-info">
          <div class="avatar">
            {% if student.photo %}
              <img src="{{ student.photo.url }}" alt="profile">
            {% else %}
              <div class="avatar-fallback">{{ student.name|slice:":1" }}</div>
            {% endif %}
          </div>
          <div class="student-meta">
            <h2 class="hello">Hello {{ student.name }}!</h2>
            <div class="subtext">Reg No: <strong>{{ student.reg_no }}</strong></div>
            <div class="subtext">{{ student.course }}</div>
          </div>
        </div>

        <div class="student-details">
          <div class="meta-row">
            <div class="meta-item">
              <div class="meta-label">Current Semester:</div>
              <div class="meta-value">{{ student.semester }}</div>
            </div>
            <div class="meta-item">
              <div class="meta-label">Academic Year</div>
              <div class="meta-value">{{ student.academic_year }}</div>
            </div>
          </div>
        </div>
      </section>

      <!-- SGPA Analysis -->
      <section class="card sgpa-card">
        <h3 class="card-title">SGPA Analysis</h3>
        <div class="chart-box">
          <canvas id="sgpaChart"></canvas>
        </div>
      </section>
      
      <!-- Summary -->
      <section class="card summary-card">
        <h3 class="card-title">Summary</h3>
        <div class="summary-grid">
          <div class="summary-item">
            <div class="summary-number">{{ total_papers }}</div>
            <div class="summary-label">Total Papers</div>
          </div>
          <div class="summary-item">
            <div class="summary-number">{{ passed }}</div>
            <div class="summary-label">Papers Passed</div>
          </div>
          <div class="summary-item">
            <div class="summary-number">{{ failed }}</div>
            <div class="summary-label">Papers Failed</div>
          </div>
        </div>
      </section>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="right-col">
      <!-- CGPA -->
      <section class="card cgpa-card">
        <div class="cgpa-title">Overall CGPA:</div>
        <div class="cgpa-value">{{ cgpa }}</div>
        <div class="cgpa-hr"></div>
      </section>

      <!-- Subject marks -->
      <section class="card subject-card">
        <div class="subject-content">
          <div class="subject-head">
            <div class="subject-left">
              <div class="small-label">SELECT SEMESTER</div>
            </div>
            <div class="sem-select-container">
              <form method="get">
                <select name="semester" class="sem-select" onchange="this.form.submit()">
                  {% for sem in semesters %}
                  <option value="{{ sem }}" {% if sem|stringformat:"s" == selected_semester|stringformat:"s" %}selected{% endif %}>
                      Semester {{ sem }}
                  </option>
                  {% endfor %}
                </select>
              </form>
            </div>
          </div>

          <div class="dial-grid">
            {% for m in marks %}
              <div class="dial">
                <canvas id="dial{{ forloop.counter }}"></canvas>
                <div class="dial-subject">{{ m.subject.name }}</div>
              </div>
            {% endfor %}
          </div>
        </div>
      </section>
    </div>
  </div>
</div>
<script>
  window.sgpaLabels = {{ sgpa_labels|safe }};
  window.sgpaValues = {{ sgpa_values|safe }};
  window.marksData = [
    {% for m in marks %}
      { marks_obtained: {{ m.marks_obtained|default:0 }}, max_marks: {{ m.max_marks|default:0 }} },
    {% endfor %}
  ];
</script>

<script src="{% static 'js/student_dashboard.js' %}"></script>



{% endblock %}
